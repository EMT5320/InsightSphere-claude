# InsightSphere Development Notes

## 技术架构决策记录

### 1. 缓存策略设计
- **问题**: CoinGecko API有频率限制，需要平衡实时性和稳定性
- **解决方案**: 
  - 使用Redis缓存API响应30秒
  - 前端60秒刷新间隔
  - 后台25秒预加载热门数据
  - 内存缓存作为Redis的fallback

### 2. 错误处理策略
- **API级别**: 统一的请求函数，包含超时、重试、格式验证
- **前端级别**: 友好的错误提示，不影响页面基本功能
- **系统级别**: 健康检查、日志记录、优雅降级

### 3. 响应式设计考虑
- **移动优先**: 使用CSS Grid和Flexbox
- **断点设计**: 768px和480px两个主要断点
- **图表适配**: Chart.js的响应式配置
- **表格处理**: 水平滚动和字体缩放

### 4. 性能优化
- **前端**: 
  - 页面可见性API控制刷新
  - Chart.js懒加载和销毁机制
  - CSS动画硬件加速
- **后端**:
  - 异步请求处理
  - 智能缓存策略
  - 资源复用

## API设计说明

### 1. /api/global
返回全球市场概览数据，包含：
- 总市值 (USD)
- 24小时总交易量 (USD)
- 比特币市值占比
- 以太坊市值占比
- 活跃加密货币数量
- 交易市场数量

### 2. /api/top10
返回市值前10的加密货币数据：
- 排名、名称、符号
- 当前价格
- 24小时价格变化
- 市值
- 24小时交易量
- 图标URL

### 3. /api/status
系统状态检查：
- Redis连接状态
- CoinGecko API连通性
- 缓存配置信息

## 部署注意事项

### Docker环境
- 使用Python 3.9-slim基础镜像
- 非root用户运行提高安全性
- 健康检查确保服务可用性
- 数据持久化通过Docker volumes

### 网络配置
- 使用8737端口避免常见冲突
- CORS配置允许本地开发
- 容器间通信使用服务名

### 监控和日志
- 应用日志使用Python logging
- 容器日志通过docker-compose logs查看
- 健康检查状态监控

## 扩展建议

### 1. 功能扩展
- 添加更多图表类型（折线图、柱状图）
- 支持自定义时间范围
- 添加价格警报功能
- 支持多种法币显示

### 2. 技术升级
- 考虑使用WebSocket实现真正实时数据
- 添加离线支持（Service Worker）
- 实现数据导出功能
- 添加用户偏好设置

### 3. 性能优化
- 实现CDN加速静态资源
- 添加数据压缩
- 考虑使用更轻量的图表库
- 实现虚拟滚动优化大数据表格

## 测试策略

### 1. 单元测试
- API端点测试
- 数据处理逻辑测试
- 缓存机制测试

### 2. 集成测试
- Docker容器启动测试
- 服务间通信测试
- 端到端API调用测试

### 3. 压力测试
- 并发请求处理能力
- 缓存命中率测试
- 内存使用监控
